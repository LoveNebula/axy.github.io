import{r as t,d as l,e as s,j as a,f as i,w as n,k as o,l as c,t as d,v as r,m as u,i as h,u as f,b as m,K as g,A as p,J as _,U as y,V as x,W as v,F as b,H as k,G as w}from"./index-CPBjD6nT.js";import{_ as C}from"./uni-datetime-picker.Skz1SJ_2.js";import{_ as A}from"./uni-data-select.C8uCwS99.js";import{_ as I}from"./uv-tags.CFwmOo6T.js";import{_ as O}from"./uni-popup.DLkoZhRS.js";import{_ as j}from"./uv-icon.BeAryk0A.js";import{e as S,f as D,g as N,h as B,i as V}from"./bizScheduApi.BbFgL-ID.js";import{_ as z}from"./uni-icons.BQCc16_L.js";import{_ as J}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{h as R}from"./html2canvas.esm.B-p-w7uj.js";import"./uv-transition.57FirIXI.js";import"./uni-popup.vue_vue_type_style_index_0_scoped_f28c6336_lang.COK6mCff.js";/* empty css                                                                  */const P={data:()=>({}),methods:{getDpr:()=>window.devicePixelRatio&&window.devicePixelRatio>1?window.devicePixelRatio:1,parseValue:e=>parseInt(e,10),generateImage(e,t){console.log("event",e);var l=this;console.log("ownerInstance",t),console.log("_this",l),document.getElementById("container").style.opacity="1";var s=document.getElementById("container"),a=window.getComputedStyle(s),i=l.parseValue(a.width),n=l.parseValue(a.height),o=l.getDpr(),c=document.createElement("canvas");c.width=i*o,c.height=n*o,c.style.width=i+"px",c.style.height=n+"px",c.getContext("2d").scale(o,o),document.getElementById("container").style.width,document.getElementById("container").style.height,R(s,{allowTaint:!1,width:window.clientWidth,height:window.clientHeight,backgroundColor:"green",useCORS:!0}).then((function(e){let l=e.toDataURL("image/png");t.callMethod("getSaveImg",{base64data:l})}))}}},E=e=>{e.$renderjs||(e.$renderjs=[]),e.$renderjs.push("canvasToImage"),e.mixins||(e.mixins=[]),e.mixins.push({beforeCreate(){this.canvasToImage=this},mounted(){this.$ownerInstance=this.$gcd(this,!0)}}),e.mixins.push(P)},L={data:()=>({sChecker:"",listAll:[],tempAll:[],single:uni.$nowDate,cars:null,telegram:"/assets/telegram-Hy2s9QQd.png",data:{},selectOrg:"",curIds:[],userInfo:{},tempNo:!0,selectData:"全部",rangeOrg:[{value:"全部",text:"全部"},{value:"航遥地信所",text:"航遥地信所"},{value:"工程测绘所",text:"工程测绘所"}]}),components:{modal:J({__name:"index",props:{title:{type:String,default:"标题"}},emits:["submit","cancel"],setup(e,{expose:m,emit:g}){const p=t(!1),_=g,y=()=>{_("submit")},x=()=>{_("cancel")};return m({submit:y,cancel:x,open:()=>{p.value=!0},close:()=>{p.value=!1}}),(t,m)=>{const g=h,_=l(s("uni-icons"),z),v=f;return 1==p.value?(a(),i(g,{key:0,class:"modalMain"},{default:n((()=>[o(g,{class:"modal_content"},{default:n((()=>[o(g,{class:"modal_header"},{default:n((()=>[o(g,null,{default:n((()=>[c(d(e.title),1)])),_:1}),o(g,{onClick:m[0]||(m[0]=e=>p.value=!1)},{default:n((()=>[o(_,{type:"closeempty",size:"30"})])),_:1})])),_:1}),o(g,{class:"modal_body"},{default:n((()=>[r(t.$slots,"bodyMain",{},void 0,!0)])),_:3}),o(g,{class:"modal_footer"},{default:n((()=>[o(v,{class:"f_btn",type:"primary",style:{"margin-right":"15px"},onClick:y},{default:n((()=>[c("确认")])),_:1}),o(v,{onClick:x,class:"f_btn"},{default:n((()=>[c("取消")])),_:1})])),_:1})])),_:3})])),_:3})):u("",!0)}}},[["__scopeId","data-v-d4939514"]])},mounted(){this.data=m("storage_data"),this.userInfo=this.data.userInfo},onShow(){S({departureDate:this.single,size:100}).then((e=>{console.log(e,"PAGE"),this.tempAll=e.data.records,this.listAll="全部"==this.selectOrg||""==this.selectOrg?this.tempAll:this.tempAll.filter((e=>e.parentName==this.selectOrg));const t=this.listAll.map((e=>e.checker));this.sChecker=[...new Set(t)].filter((e=>""!==e&&null!==e)).join(),this.cars=this.setCar(this.listAll,"vehicle")}))},methods:{changeOrg(e){if(this.selectOrg=e,"全部"==e||""==e)this.listAll=this.tempAll;else{console.log(e),this.listAll=this.tempAll.filter((t=>t.parentName==e)),console.log(this.listAll);const t=this.listAll.map((e=>e.checker));this.sChecker=[...new Set(t)].filter((e=>""!==e&&null!==e)).join()}},tijiao(e){var t,l;let s=JSON.parse(JSON.stringify(e));s.device=null==(t=s.device)?void 0:t.split(","),s.members=null==(l=s.members)?void 0:l.split(","),console.log(s),D(s).then((e=>{console.log(e),200==e.code&&(g({title:"提交成功",duration:2e3,icon:"none"}),this.refreshList())}))},toImport(){console.log("this.single",this.single),p({url:"/pages/schedule/importSchedule?date="+this.single})},stateChange(e){switch(e){case-1:return"暂存";case 0:return"已提交";case 1:return"已确认";case 2:return"已发布"}},allConfirm(){"全部"!=this.selectOrg&&""!=this.selectOrg||"王凯"==this.userInfo.account?"航遥地信所"!=this.selectOrg||"孙士通"==this.userInfo.account?"工程测绘所"!=this.selectOrg||"李浩飞"==this.userInfo.account?0!=this.listAll.length?this.cars?(this.curIds=this.listAll.map((e=>e.id)).join(","),console.log(this.curIds),_({title:"提示",content:"当前日期车辆有重复，是否继续提交？",success:e=>{e.confirm?N(this.curIds).then((e=>{console.log(e),this.daas()})):e.cancel}})):(this.curIds=this.listAll.map((e=>e.id)).join(","),console.log(this.curIds),N(this.curIds).then((e=>{console.log(e),this.daas()}))):g({title:"请先新增排班再确认提交",duration:1500}):g({title:"工程测绘所请李浩飞确认",icon:"none"}):g({title:"航遥地信所请孙士通确认",icon:"none"}):g({title:"全部排班请王凯确认",icon:"none"})},getSaveImg(t){if(console.log("data",t),("全部"==this.selectOrg||""==this.selectOrg)&&"王凯"!=this.userInfo.account)return void g({title:"全部排班请王凯发布",icon:"none"});if("航遥地信所"==this.selectOrg&&"孙士通"!=this.userInfo.account)return void g({title:"航遥地信所请孙士通发布",icon:"none"});if("工程测绘所"==this.selectOrg&&"李浩飞"!=this.userInfo.account)return void g({title:"工程测绘所请李浩飞发布",icon:"none"});let l=this;0!=this.listAll.length?this.cars?_({title:"提示",content:"当前日期车辆有重复，是否继续提交？",success:s=>{s.confirm?(this.curIds=this.listAll.map((e=>e.id)).join(","),B(this.curIds).then((s=>{if(200==s.code){l.daas(),g({title:"发布成功",duration:1234});let s=t.base64data,a=new plus.nativeObj.Bitmap("test");a.loadBase64Data(s,(function(){console.log("加载Base64图片数据成功");let e="_downloads/test2.png";a.save(e,{},(function(t){console.log("保存图片成功："+JSON.stringify(t)),y({filePath:e,success:function(){g({title:"图片保存成功",icon:"none"}),plus.io.resolveLocalFileSystemURL(e,(function(e){e.getMetadata((function(t){e.remove()}))}),(function(e){console.log("error"+e)})),a.clear()}}),a.clear()}),(function(e){onsole.log("保存图片失败："+JSON.stringify(e)),a.clear()}))}),(function(){console.log("加载Base64图片数据失败："+JSON.stringify(e)),a.clear()}))}}))):s.cancel}}):(this.curIds=this.listAll.map((e=>e.id)).join(","),B(this.curIds).then((s=>{console.log(s),l.daas(),g({title:"发布成功",duration:1234});let a=t.base64data,i=new plus.nativeObj.Bitmap("test");i.loadBase64Data(a,(function(){console.log("加载Base64图片数据成功");let e="_downloads/test2.png";i.save(e,{},(function(t){console.log("保存图片成功："+JSON.stringify(t)),y({filePath:e,success:function(){g({title:"图片保存成功",icon:"none"}),plus.io.resolveLocalFileSystemURL(e,(function(e){e.getMetadata((function(t){e.remove()}))}),(function(e){console.log("error"+e)})),i.clear()}}),i.clear()}),(function(e){onsole.log("保存图片失败："+JSON.stringify(e)),i.clear()}))}),(function(){console.log("加载Base64图片数据失败："+JSON.stringify(e)),i.clear()}))}))):g({title:"请先新增排班再确认提交",duration:1500})},changeDate(e){this.single=e,this.alwaysReq()},editDetail(e){e.date=this.single,p({url:"/pages/schedule/addSchedule?id="+JSON.stringify(e)})},alwaysReq(){S({departureDate:this.single}).then((e=>{console.log(e,"PAGE"),this.tempAll=e.data.records,"全部"==this.selectOrg||""==this.selectOrg?this.listAll=this.tempAll:this.listAll=this.tempAll.filter((e=>e.parentName==this.selectOrg));let t=this.listAll.map((e=>e.checker));this.sChecker=[...new Set(t)].filter((e=>""!==e&&null!==e)).join(),this.cars=this.setCar(this.listAll,"vehicle")}))},refreshList(){x({title:"刷新中，请稍等"}),S({departureDate:this.single}).then((e=>{console.log(e,"PAGE"),200==e.code?(v(),this.tempAll=e.data.records,this.listAll="全部"==this.selectOrg||""==this.selectOrg?this.tempAll:this.tempAll.filter((e=>e.parentName==this.selectOrg)),this.cars=this.setCar(this.listAll,"vehicle")):(v(),g({title:"网络错误，请稍后再试",duration:1e3}))}))},daas(){this.alwaysReq()},delDetail(e,t){_({title:"提示",content:"此操作会删除此项排班",success:t=>{t.confirm?V([{id:e.id}]).then((e=>{console.log(e),200==e.code&&S({departureDate:this.single}).then((e=>{console.log(e,"PAGE"),this.listAll=e.data.records,this.cars=this.setCar(this.listAll,"vehicle")}))})):t.cancel}})},toAdd(){p({url:"/pages/schedule/addSchedule?date="+this.single})},changeState(e){console.log(e,"renderS"),this.tempNo=!1},setCar(e,t){let l=new Set;for(let s of e){if(l.has(s[t]))return!0;l.add(s[t])}return!1}}};E(L);const M=J(L,[["render",function(e,t,r,f,m,g){const p=h,_=l(s("uni-datetime-picker"),C),y=l(s("uni-data-select"),A),x=l(s("uv-tags"),I),v=l(s("uni-popup"),O),S=l(s("uv-icon"),j);return a(),b(k,null,[o(p,{class:"duleMain"},{default:n((()=>[o(p,{class:"dule_content"},{default:n((()=>[o(p,{class:"flexStart",style:{"margin-left":"5px","margin-top":"15px"}},{default:n((()=>[o(p,null,{default:n((()=>[c(" 选择出班日期：")])),_:1}),o(p,null,{default:n((()=>[o(_,{style:{width:"200px"},type:"date","clear-icon":!1,modelValue:m.single,"onUpdate:modelValue":t[0]||(t[0]=e=>m.single=e),onChange:g.changeDate},null,8,["modelValue","onChange"])])),_:1}),o(p,{class:""},{default:n((()=>[o(y,{style:{width:"120px"},modelValue:m.selectData,"onUpdate:modelValue":t[1]||(t[1]=e=>m.selectData=e),localdata:m.rangeOrg,onChange:g.changeOrg},null,8,["modelValue","localdata","onChange"])])),_:1})])),_:1}),o(p,{class:"flexColumn",style:{"margin-top":"15px"}},{default:n((()=>[o(p,{style:{"font-size":"18px","font-weight":"bold"}},{default:n((()=>[c(" 审核发布："+d(m.sChecker),1)])),_:1}),o(p,{style:{"margin-top":"10px",width:"100%"}},{default:n((()=>[o(p,{class:"table_header"},{default:n((()=>[o(p,{style:{flex:"1"},class:"header_item"},{default:n((()=>[c("组长")])),_:1}),o(p,{style:{flex:"1"},class:"header_item"},{default:n((()=>[c("组员")])),_:1}),o(p,{style:{width:"33%"},class:"header_item"},{default:n((()=>[c("仪器")])),_:1}),o(p,{style:{flex:"1"},class:"header_item"},{default:n((()=>[c("车辆")])),_:1}),o(p,{style:{flex:"1"},class:"header_item"},{default:n((()=>[c("司机")])),_:1})])),_:1}),o(p,{class:"table_body"},{default:n((()=>[(a(!0),b(k,null,w(m.listAll,((t,l)=>(a(),i(p,{class:"body_item",key:l},{default:n((()=>[o(p,{class:"body_content"},{default:n((()=>[o(p,{class:"body_content_item"},{default:n((()=>[o(p,null,{default:n((()=>[c(d(t.projectId),1)])),_:2},1024),o(p,{style:{display:"flex","align-items":"center"}},{default:n((()=>[o(p,{class:"item_left"},{default:n((()=>[c(d(t.name),1)])),_:2},1024),o(p,{class:"item_right"},{default:n((()=>[o(x,{text:g.stateChange(t.checkState),plain:""},null,8,["text"])])),_:2},1024)])),_:2},1024)])),_:2},1024),o(p,{class:"body_item_content"},{default:n((()=>[o(p,{style:{flex:"1"},class:"content_item"},{default:n((()=>[c(d(t.leader),1)])),_:2},1024),o(p,{style:{display:"flex",flex:"1","align-items":"center","justify-content":"center"},class:"content_item"},{default:n((()=>["[]"==t.members||null==t.members?(a(),i(p,{key:0})):(a(),i(p,{key:1,style:{display:"flex","flex-direction":"column",padding:"5px 0"}},{default:n((()=>[(a(!0),b(k,null,w(t.members.split(","),((e,t)=>(a(),i(p,{key:t},{default:n((()=>[c(d(e),1)])),_:2},1024)))),128))])),_:2},1024))])),_:2},1024),o(p,{style:{width:"33%","border-right":"1px solid","font-size":"14px"}},{default:n((()=>["[]"==t.device||null==t.device?(a(),b("p",{key:0})):(a(),i(p,{key:1},{default:n((()=>[(a(!0),b(k,null,w(t.device.split(","),((l,s)=>(a(),b("p",{key:e.sindex,style:{"word-wrap":"break-word"}},d(l)+" "+d(t.device.length>0?",":""),1)))),128))])),_:2},1024))])),_:2},1024),o(p,{style:{flex:"1"},class:"content_item"},{default:n((()=>[c(d(t.vehicle),1)])),_:2},1024),o(p,{style:{flex:"1"},class:"content_item"},{default:n((()=>[c(d(t.driver),1)])),_:2},1024)])),_:2},1024),o(p,{class:"body_header",style:{padding:"0 3px"}},{default:n((()=>[o(p,null,{default:n((()=>[c(d(t.recordMaker),1)])),_:2},1024),o(p,{style:{"font-size":"14px",color:"#000"}},{default:n((()=>[c(d(t.notes),1)])),_:2},1024),o(p,{class:"actionBox"},{default:n((()=>[o(p,{style:{width:"75px",height:"100%","text-align":"center","line-height":"30px",background:"#00b894","margin-right":"2px",color:"#fff"},onClick:e=>g.editDetail(t)},{default:n((()=>[c("编辑")])),_:2},1032,["onClick"]),-1==t.checkState?(a(),i(p,{key:0,style:{width:"75px",height:"100%","text-align":"center","line-height":"30px",background:"#336699","margin-right":"2px",color:"#fff"},onClick:e=>g.tijiao(t)},{default:n((()=>[c("提交")])),_:2},1032,["onClick"])):u("",!0),e.$snowy.hasPerm(["work_canDelete"])?(a(),i(p,{key:1,style:{width:"75px",height:"100%","text-align":"center","line-height":"30px",background:"#d63031",color:"#fff"},onClick:e=>g.delDetail(t,l)},{default:n((()=>[c("删除")])),_:2},1032,["onClick"])):u("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})])),_:1}),o(p,{class:"dule_content",id:"container",style:{position:"fixed",top:"10000%"}},{default:n((()=>[o(p,{class:"flexStart",style:{"margin-left":"5px","margin-top":"15px"}},{default:n((()=>[o(p,null,{default:n((()=>[c(" 选择出班日期：")])),_:1}),o(p,null,{default:n((()=>[o(_,{style:{width:"200px"},type:"date","clear-icon":!1,modelValue:m.single,"onUpdate:modelValue":t[2]||(t[2]=e=>m.single=e),onChange:g.changeDate},null,8,["modelValue","onChange"])])),_:1})])),_:1}),o(p,{class:"flexColumn",style:{"margin-left":"5px","margin-top":"15px"}},{default:n((()=>[o(p,{style:{"font-size":"18px","font-weight":"bold"}},{default:n((()=>[c(" 审核发布："+d(m.sChecker),1)])),_:1}),o(p,{style:{"font-size":"18px","font-weight":"bold"}},{default:n((()=>[c(" 审核范围："+d("全部"==m.selectOrg||""==m.selectOrg?"全分院":m.selectOrg),1)])),_:1}),o(p,{style:{"margin-top":"10px",width:"100%"}},{default:n((()=>[o(p,{class:"table_header"},{default:n((()=>[o(p,{style:{flex:"1"},class:"header_item"},{default:n((()=>[c("组长")])),_:1}),o(p,{style:{flex:"1"},class:"header_item"},{default:n((()=>[c("组员")])),_:1}),o(p,{style:{width:"33%"},class:"header_item"},{default:n((()=>[c("仪器")])),_:1}),o(p,{style:{flex:"1"},class:"header_item"},{default:n((()=>[c("车辆")])),_:1}),o(p,{style:{flex:"1"},class:"header_item"},{default:n((()=>[c("司机")])),_:1})])),_:1}),o(p,{class:"table_body"},{default:n((()=>[(a(!0),b(k,null,w(m.listAll,((t,l)=>(a(),i(p,{class:"body_item",key:l},{default:n((()=>[o(p,{class:"body_content"},{default:n((()=>[o(p,{class:"body_content_item"},{default:n((()=>[o(p,null,{default:n((()=>[c(d(t.projectId),1)])),_:2},1024),o(p,{style:{display:"flex","align-items":"center"}},{default:n((()=>[o(p,{class:"item_left"},{default:n((()=>[c(d(t.name),1)])),_:2},1024),o(p,{class:"item_right"},{default:n((()=>[o(x,{text:"已发布",plain:""})])),_:1})])),_:2},1024)])),_:2},1024),o(p,{class:"body_item_content"},{default:n((()=>[o(p,{style:{flex:"1"},class:"content_item"},{default:n((()=>[c(d(t.leader),1)])),_:2},1024),o(p,{style:{display:"flex",flex:"1","align-items":"center","justify-content":"center"},class:"content_item"},{default:n((()=>["[]"==t.members||null==t.members?(a(),i(p,{key:0})):(a(),i(p,{key:1,style:{display:"flex","flex-direction":"column",padding:"5px 0"}},{default:n((()=>[(a(!0),b(k,null,w(t.members.split(","),((e,t)=>(a(),i(p,{key:t},{default:n((()=>[c(d(e),1)])),_:2},1024)))),128))])),_:2},1024))])),_:2},1024),o(p,{style:{width:"33%","border-right":"1px solid","font-size":"14px"}},{default:n((()=>[o(p,{style:{}},{default:n((()=>["[]"==t.device||null==t.device?(a(),b("p",{key:0})):(a(),i(p,{key:1},{default:n((()=>[(a(!0),b(k,null,w(t.device.split(","),((l,s)=>(a(),b("p",{key:e.sindex,style:{"word-wrap":"break-word"}},d(l)+" "+d(1==t.device.length?"":"、"),1)))),128))])),_:2},1024))])),_:2},1024)])),_:2},1024),o(p,{style:{flex:"1"},class:"content_item"},{default:n((()=>[c(d(t.vehicle),1)])),_:2},1024),o(p,{style:{flex:"1"},class:"content_item"},{default:n((()=>[c(d(t.driver),1)])),_:2},1024)])),_:2},1024),o(p,{class:"body_header",style:{padding:"0 3px"}},{default:n((()=>[o(p,null,{default:n((()=>[c(d(t.recordMaker),1)])),_:2},1024),o(p,{style:{"font-size":"14px",color:"#000"}},{default:n((()=>[c(d(t.notes),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})])),_:1}),o(p,{class:"tab_bottom"},{default:n((()=>[o(p,{class:"bottoms",onClick:g.toAdd},{default:n((()=>[c("新增")])),_:1},8,["onClick"]),o(p,{class:"bottoms",onClick:g.refreshList},{default:n((()=>[c("刷新")])),_:1},8,["onClick"]),o(p,{class:"bottoms",onClick:g.allConfirm},{default:n((()=>[c("全部确认")])),_:1},8,["onClick"])])),_:1})])),_:1}),o(v,{ref:"popup",type:"center"},{default:n((()=>[o(p,{style:{display:"flex","flex-direction":"column",width:"100px","justify-content":"center",background:"#fff","align-items":"center"}},{default:n((()=>[c(d(e.popupTitle)+" ",1),(a(!0),b(k,null,w(e.sbList,((e,t)=>(a(),i(p,{style:{"margin-top":"5px"},key:t},{default:n((()=>[c(d(e),1)])),_:2},1024)))),128))])),_:1})])),_:1},512),o(p,{class:"fab_fly"}),o(p,{class:"fabA",onClick:e.canvasToImage.generateImage},{default:n((()=>[o(S,{name:"coupon-fill",size:"35",color:"rgb(18,150,219)"})])),_:1},8,["onClick"]),o(p,{class:"fabB",onClick:g.toImport},{default:n((()=>[c("导入历史")])),_:1},8,["onClick"])],64)}],["__scopeId","data-v-be209ced"]]);export{M as default};
