import{g as e,r as a,c as s,a as l,o as t,b as o,s as n,d as i,e as r,f as c,w as u,h as d,i as p,j as m,k as g,l as _,m as h,t as f,n as y,p as v,q as C,I as S,u as x}from"./index-CPBjD6nT.js";import{_ as w}from"./uv-icon.BeAryk0A.js";import{_ as A}from"./_plugin-vue_export-helper.BCo6x5W8.js";function E(){e().platform}const N=A({__name:"login",setup(e){const A=()=>{uni.$snowy.tab.reLaunch("/pages/config/index")},N=a(),O=s((()=>n.getters.sysBaseConfig)),U=a(""),L=l({});t((()=>{if(console.log('uni.getStorageSync("login")',o("login")),o("login")){let e=JSON.parse(o("login"));L.account=e.account,L.password=e.password}console.log("store.getters.allEnv[store.getters.envKey].baseUrl",n.getters.allEnv[n.getters.envKey].baseUrl),plus.runtime.getProperty(plus.runtime.appid,(e=>{N.value=e.version}))}));const P=()=>{d().then((e=>{U.value=e.data.validCodeBase64,L.validCodeReqNo=e.data.validCodeReqNo}))};O.value.SNOWY_SYS_DEFAULT_CAPTCHA_OPEN&&P();const T=async()=>{""===L.account?uni.$snowy.modal.msgError("请输入账号"):""===L.password?uni.$snowy.modal.msgError("请输入密码"):""===L.validCode&&"true"===O.value.SNOWY_SYS_DEFAULT_CAPTCHA_OPEN?uni.$snowy.modal.msgError("请输入验证码"):(y("login",JSON.stringify(L)),Y())},Y=async()=>{n.dispatch("Login",L).then((()=>{Promise.all([n.dispatch("GetUserLoginMenu"),n.dispatch("GetUserInfo"),n.dispatch("GetDictTypeTreeData")]).then((e=>{const{searchQuery:a,hashQuery:s}=uni.$xeu.parseUrl(location.href);a.redirect?uni.$snowy.tab.reLaunch(a.redirect):s.redirect?uni.$snowy.tab.reLaunch(s.redirect):uni.$snowy.tab.reLaunch("/pages/work/index")})).catch((e=>{E(),O.value.SNOWY_SYS_DEFAULT_CAPTCHA_OPEN&&(P(),L.validCode="")}))})).catch((e=>{E(),O.value.SNOWY_SYS_DEFAULT_CAPTCHA_OPEN&&(P(),L.validCode="")}))};return(e,a)=>{const s=v,l=C,t=p,o=i(r("uv-icon"),w),n=S,d=x;return m(),c(t,{class:"login-container"},{default:u((()=>[g(t,{class:"logo-content",onClick:A},{default:u((()=>[g(s,{style:{width:"100rpx",height:"100rpx"},alt:O.value.SNOWY_SYS_NAME,src:"/assets/loginLogo-CMD6J9_W.png",mode:"widthFix"},null,8,["alt"]),g(l,{class:"title"},{default:u((()=>[_("测绘资源平台App")])),_:1})])),_:1}),g(t,{class:"login-form-content"},{default:u((()=>[g(t,{class:"input-item"},{default:u((()=>[g(o,{class:"icon",name:"account-fill",size:"20",color:"#999"}),g(n,{modelValue:L.account,"onUpdate:modelValue":a[0]||(a[0]=e=>L.account=e),class:"input",type:"text",placeholder:"请输入账号",maxlength:"30"},null,8,["modelValue"])])),_:1}),g(t,{class:"input-item"},{default:u((()=>[g(o,{class:"icon",name:"lock-fill",size:"20",color:"#999"}),g(n,{modelValue:L.password,"onUpdate:modelValue":a[1]||(a[1]=e=>L.password=e),type:"password",class:"input",placeholder:"请输入密码",maxlength:"20"},null,8,["modelValue"])])),_:1}),"true"===O.value.SNOWY_SYS_DEFAULT_CAPTCHA_OPEN?(m(),c(t,{key:0,class:"input-item"},{default:u((()=>[g(o,{class:"icon",name:"empty-permission",size:"20",color:"#999"}),g(n,{modelValue:L.validCode,"onUpdate:modelValue":a[2]||(a[2]=e=>L.validCode=e),type:"text",class:"input",placeholder:"请输入验证码",maxlength:"4"},null,8,["modelValue"]),g(s,{src:U.value,onClick:P,class:"login-code-img"},null,8,["src"])])),_:1})):h("",!0),g(t,null,{default:u((()=>[g(d,{onClick:T,class:"login-btn",type:"primary"},{default:u((()=>[_("登录")])),_:1})])),_:1})])),_:1}),g(t,{class:"",style:{position:"fixed",width:"100%",height:"45px",left:"0",bottom:"15px",display:"flex","justify-content":"center","align-items":"center","font-size":"20px"}},{default:u((()=>[_(" 当前版本:"+f(N.value),1)])),_:1})])),_:1})}}},[["__scopeId","data-v-4331b829"]]);export{N as default};
