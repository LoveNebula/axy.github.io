import{B as e,a0 as a,s as l,a1 as t,a2 as i,a3 as r,a4 as d,a5 as n,a6 as u,a7 as o,Y as s,K as p,r as m,c as f,a8 as c,j as h,f as y,w as g,k as v,F as T,H as b,G as R,x as A,R as x,m as P,l as U,t as w,y as E,v as S,a9 as $,aa as _,J as I,p as D,i as k,q as C,ab as K,O as F,d as N,e as O}from"./index-CPBjD6nT.js";import{_ as V}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{p as j,r as L}from"./gcVehicleRecordManage.B03dmY0w.js";const{TIMEOUT:M,TOKEN_NAME:z,TOKEN_PREFIX:q,NO_TOKEN_BACK_URL:B}=o,J=o=>{o.url=e(o.url);const s=!1===(o.extConf||{}).isToken;if(o.header=o.header||{},a()&&!s&&(o.header[z]=q+a()),o.header.Domain=l.getters.allEnv[l.getters.envKey].tenantDomain,o.params){let e=o.url+"?"+t(o.params);e=e.slice(0,-1),o.url=e}return new Promise(((e,a)=>{uni.$snowy.modal.loading("努力加载中"),i({timeout:o.timeout||M,url:o.actionUrl||(o.baseUrl||l.getters.allEnv[l.getters.envKey].baseUrl)+o.url,file:o.file,filePath:o.filePath,name:o.name||"file",header:o.header,formData:o.formData,success:t=>{"string"==typeof t.data&&(t.data=JSON.parse(t.data));const i=t.data.code||200,o=t.data.msg||r[i]||r.default;d.includes(i)?(uni.$snowy.modal.confirm(o||"登录状态已过期，您可以清除缓存，重新进行登录?").then((()=>{l.commit("CLEAR_cache"),uni.$snowy.tab.reLaunch(n(B,u()))})),a("无效的会话，或者会话已过期，请重新登录。")):200!==i&&(uni.$snowy.modal.alert(o),a(i)),e(t.data)},fail:e=>{let{errMsg:l}=e;"Network Error"===l?l="后端接口连接异常":l.includes("timeout")?l="系统接口请求超时":l.includes("Request failed with status code")?l="系统接口"+l.substr(l.length-3)+"异常":l.includes("request:fail")&&(l="请求失败"),uni.$snowy.modal.alert(l),a(e)},complete:()=>{uni.$snowy.modal.closeLoading()}})}))};function G(e){return s({url:"/dev/file/detail",method:"GET",data:e})}const Q=e=>{e&&p({title:e,icon:"none"})},X=V({__name:"snowy-file-picker",props:{modelValue:[String,Array],uploadType:{type:String,default:"Dynamic"},paramAndReturnType:{type:String,default:"idStr"},map:{type:Object,default:{id:"id",name:"name",url:"url",ext:"ext"},required:!1},width:{type:[Number,String],default:200},height:{type:[Number,String],default:200},radius:{type:[Number,String],default:0},background:{type:String,default:"#F7F7F7"},borderColor:{type:String,default:"transparent"},borderSytle:{type:String,default:"dashed"},delColor:{type:String,default:""},delConfirm:{type:Boolean,default:!1},forbidDel:{type:Boolean,default:!1},addColor:{type:String,default:"#888"},addSize:{type:[Number,String],default:68},forbidAdd:{type:Boolean,default:!1},limit:{type:Number,default:9},sizeType:{type:Array,default:()=>["original","compressed"]},sourceType:{type:Array,default:()=>["album","camera"]},imageFormat:{type:Array,default:()=>[]},size:{type:Number,default:40}},emits:["update:modelValue"],setup(a,{emit:t}){const{proxy:i}=K(),r=t,d=a,n=m([]),u=m([]),o=f((()=>{let e=!0;return(d.forbidAdd||d.limit&&n.value.length>=d.limit)&&(e=!1),e})),s=f((()=>d.delColor||uni&&uni.$tui&&uni.$tui.color.danger||"#EB0909")),p=()=>{const a=(()=>{let e=[];return uni.$xeu.isEmpty(d.modelValue)||(uni.$xeu.isString(d.modelValue)&&("jsonStr"===d.paramAndReturnType?JSON.parse(d.modelValue).forEach((a=>{e.push(a[d.map.id])})):d.modelValue.split(",").forEach((a=>{var l,t;"idStr"===d.paramAndReturnType&&e.push(a),"urlStr"===d.paramAndReturnType&&e.push(null==(t=null==(l=uni.$xeu.parseUrl(a[d.map.url]))?void 0:l.searchQuery)?void 0:t.id)}))),uni.$xeu.isArray(d.modelValue)&&d.modelValue.forEach((a=>{var l,t,i,r;"idArr"===d.paramAndReturnType&&e.push(a),"urlArr"===d.paramAndReturnType&&e.push(null==(t=null==(l=uni.$xeu.parseUrl(a[d.map.url]))?void 0:l.searchQuery)?void 0:t.id),"objArr"===d.paramAndReturnType&&e.push((null==(r=null==(i=uni.$xeu.parseUrl(a[d.map.url]))?void 0:i.searchQuery)?void 0:r.id)||a[d.map.id])}))),e})(),t=[];n.value=[];for(let i=0;i<a.length;i++)t.push(new Promise(((t,r)=>{u.value.push("2"),G({id:a[i]}).then((a=>{n.value.push({[d.map.id]:a.data.id,[d.map.name]:a.data.name,[d.map.url]:a.data.downloadPath||`${l.getters.allEnv[l.getters.envKey].baseUrl}${e("/dev/")}file/download?id=${a.data.id}`,[d.map.ext]:a.data.suffix}),u.value[i]="1",t()})).catch((e=>{r(e)}))})));Promise.all(t).then((()=>{})).catch((e=>{console.log(e)}))},F=m(!0);c((()=>d.modelValue),((e,a)=>{F.value&&p(),F.value=!0}),{deep:!1,immediate:!0});const N=a=>["png","jpg","jpng","ico","gif","image/png"].includes(a[d.map.ext])?a[d.map.url]:["doc"].includes(a[d.map.ext])?l.getters.allEnv[l.getters.envKey].baseUrl+e("/images/")+"fileImg/docx.png":["xls"].includes(a[d.map.ext])?l.getters.allEnv[l.getters.envKey].baseUrl+e("/images/")+"fileImg/xlsx.png":["zip"].includes(a[d.map.ext])?l.getters.allEnv[l.getters.envKey].baseUrl+e("/images/")+"fileImg/zip.png":["rar"].includes(a[d.map.ext])?l.getters.allEnv[l.getters.envKey].baseUrl+e("/images/")+"fileImg/rar.png":["ppt"].includes(a[d.map.ext])?l.getters.allEnv[l.getters.envKey].baseUrl+e("/images/")+"fileImg/ppt.png":["txt"].includes(a[d.map.ext])?l.getters.allEnv[l.getters.envKey].baseUrl+e("/images/")+"fileImg/txt.png":["html"].includes(a[d.map.ext])?l.getters.allEnv[l.getters.envKey].baseUrl+e("/images/")+"fileImg/html.png":l.getters.allEnv[l.getters.envKey].baseUrl+e("/images/")+"fileImg/file.png",O=()=>{if("objArr"===d.paramAndReturnType)return n.value;if("jsonStr"===d.paramAndReturnType)return JSON.stringify(n.value);let e=null;const a=[];return"idStr"!==d.paramAndReturnType&&"idArr"!==d.paramAndReturnType||n.value.forEach((e=>{a.push(e[d.map.id])})),"urlStr"!==d.paramAndReturnType&&"urlArr"!==d.paramAndReturnType||n.value.forEach((e=>{a.push(e[d.map.url])})),"idArr"!==d.paramAndReturnType&&"urlArr"!==d.paramAndReturnType||(e=a),"idStr"!==d.paramAndReturnType&&"urlStr"!==d.paramAndReturnType||(e=a.join(",")),e},V=()=>{_({count:d.limit-n.value.length,sizeType:d.sizeType,sourceType:d.sourceType,success:function(e){const a=[];for(let l=0;l<e.tempFiles.length;l++){if(n.value.length>=d.limit){Q(`最多可上传${d.limit}张图片`);break}if(e.tempFiles[l].path,d.imageFormat.length>0){let a="";if(a=e.tempFiles[l].type.split("/")[1],-1==d.imageFormat.indexOf(a)){let e=`只能上传 ${d.imageFormat.join(",")} 格式图片！`;Q(e);continue}}let t=e.tempFiles[l].size;if(1024*d.size*1024<t){let e=`单张图片大小不能超过：${d.size}MB`;Q(e)}else u.value.push("2"),a.push(L(e.tempFiles[l].path,u.value.length-1))}Promise.all(a).then((e=>{F.value=!1,r("update:modelValue",O()),uni.$uv.formValidate(i,"change")})).catch((e=>{console.log(e)}))}})},j=e=>new Promise(((a,l)=>{"Local"==d.uploadType?function(e){return J({url:"/dev/file/uploadLocalReturnId",file:e.file,filePath:e.filePath})}(e).then((e=>{a(e)})).catch((e=>{l(e)})):"Aliyun"==d.uploadType?function(e){return J({url:"/dev/file/uploadAliyunReturnId",file:e.file,filePath:e.filePath})}(e).then((e=>{a(e)})).catch((e=>{l(e)})):"Tencent"==d.uploadType?function(e){return J({url:"/dev/file/uploadTencentReturnId",file:e.file,filePath:e.filePath})}(e).then((e=>{a(e)})).catch((e=>{l(e)})):function(e){return J({url:"/dev/file/uploadDynamicReturnId",file:e.file,filePath:e.filePath})}(e).then((e=>{a(e)})).catch((e=>{l(e)}))})),L=(a,t)=>new Promise(((i,r)=>{j({filePath:a}).then((o=>{G({id:o.data}).then((a=>{const r={[d.map.id]:a.data.id,[d.map.name]:a.data.name,[d.map.url]:a.data.downloadPath||`${l.getters.allEnv[l.getters.envKey].baseUrl}${e("/dev/")}file/download?id=${a.data.id}`,[d.map.ext]:a.data.suffix};n.value.push(r),u.value[t]="1",i(r)})).catch((e=>{const l={itemTempFilePath:a};n.value.push(l),u.value[t]="3",r(e)}))})).catch((e=>{const l={itemTempFilePath:a};n.value.push(l),u.value[t]="3",r(e)}))})),M=e=>{n.value.splice(e,1),u.value.splice(e,1),r("update:modelValue",O()),uni.$uv.formValidate(i,"change")};return(t,i)=>{const r=D,p=k,m=C;return h(),y(p,{class:"tui-upload__container"},{default:g((()=>[v(p,{class:"tui-upload-box"},{default:g((()=>[(h(!0),T(b,null,R(n.value,((t,i)=>(h(),y(p,{class:"tui-image-item",style:A({width:a.width+"rpx",height:a.height+"rpx",borderRadius:a.radius+"rpx"}),key:i},{default:g((()=>[v(r,{class:"item-img",style:A({width:a.width+"rpx",height:a.height+"rpx",borderRadius:a.radius+"rpx"}),src:N(t),mode:"aspectFill",onClick:x((e=>(e=>{["png","jpg","jpng","ico","gif","image/png"].includes(null==e?void 0:e.ext)?$({current:e[d.map.url],loop:!0,urls:[e[d.map.url]]}):self.location.href=e[d.map.url]})(t)),["stop"])},null,8,["style","src","onClick"]),a.forbidDel?P("",!0):(h(),y(p,{key:0,class:"tui-img-del",style:A({background:s.value}),onClick:x((e=>(e=>{d.delConfirm?I({title:"提示",content:"确认删除该图片吗？",showCancel:!0,cancelColor:"#555",confirmColor:"#eb0909",confirmText:"确定",success(a){a.confirm&&M(e)}}):M(e)})(i)),["stop"])},null,8,["style","onClick"])),1!=u.value[i]?(h(),y(p,{key:1,class:"tui-upload-mask"},{default:g((()=>[2==u.value[i]?(h(),y(p,{key:0,class:"tui-upload-loading"})):P("",!0),v(m,{class:"tui-tips"},{default:g((()=>[U(w(2==u.value[i]?"上传中...":"上传失败"),1)])),_:2},1024),3==u.value[i]?(h(),y(p,{key:1,class:"tui-mask-btn",onClick:x((a=>(a=>{u.value[a]="2",j({filePath:n.value[a].itemTempFilePath}).then((t=>{G({id:t.data}).then((t=>{n.value[a]={[d.map.id]:t.data.id,[d.map.name]:t.data.name,[d.map.url]:t.data.downloadPath||`${l.getters.allEnv[l.getters.envKey].baseUrl}${e("/dev/")}file/download?id=${t.data.id}`,[d.map.ext]:t.data.suffix},u.value[a]="1"})).catch((e=>{u.value[a]="3"}))})).catch((e=>{u.value[a]="3"}))})(i)),["stop"]),"hover-class":"tui-btn-hover","hover-stay-time":150},{default:g((()=>[U("重新上传")])),_:2},1032,["onClick"])):P("",!0)])),_:2},1024)):P("",!0)])),_:2},1032,["style"])))),128)),o.value?(h(),y(p,{key:0,class:E(["tui-upload-add",["transparent"!==a.borderColor?"tui-upload__border":"tui-upload__unborder"]]),style:A({width:a.width+"rpx",height:a.height+"rpx",background:a.background,borderRadius:a.radius+"rpx",borderColor:a.borderColor,borderStyle:a.borderSytle}),onClick:V},{default:g((()=>[S(t.$slots,"default",{},(()=>[v(p,{class:"tui-upload-icon tui-icon-plus",style:A({color:a.addColor,fontSize:a.addSize+"rpx"})},null,8,["style"])]),!0)])),_:3},8,["class","style"])):P("",!0)])),_:3})])),_:3})}}},[["__scopeId","data-v-7e91f568"]]),{TIMEOUT:H,TOKEN_NAME:Y,TOKEN_PREFIX:W,NO_TOKEN_BACK_URL:Z}=o,ee=e=>{e.url=j(e.url);const o=!1===(e.extConf||{}).isToken;if(e.header=e.header||{},a()&&!o&&(e.header[Y]=W+a()),e.header.Domain=l.getters.tenantDomain,e.params){let a=e.url+"?"+t(e.params);a=a.slice(0,-1),e.url=a}return new Promise(((a,t)=>{uni.$snowy.modal.loading("努力加载中"),i({timeout:e.timeout||H,url:e.actionUrl||(e.baseUrl||l.getters.allEnv[l.getters.envKey].baseUrl)+e.url,file:e.file,filePath:e.filePath,name:e.name||"file",header:e.header,formData:e.formData,success:i=>{var o;"string"==typeof i.data&&(i.data=JSON.parse(i.data));const s=i.data.code||200,p=i.data.msg||r[s]||r.default;d.includes(s)?(uni.$snowy.modal.confirm(p||"登录状态已过期，您可以清除缓存，重新进行登录?").then((()=>{l.commit("CLEAR_cache"),uni.$snowy.tab.reLaunch(n(Z,u()))})),t("无效的会话，或者会话已过期，请重新登录。")):200!==s&&(uni.$snowy.modal.alert(p),t(s)),e.isReturnOriginalData?a(null==i?void 0:i.data):a(null==(o=null==i?void 0:i.data)?void 0:o.data)},fail:e=>{let{errMsg:a}=e;"Network Error"===a?a="后端接口连接异常":a.includes("timeout")?a="系统接口请求超时":a.includes("Request failed with status code")?a="系统接口"+a.substr(a.length-3)+"异常":a.includes("request:fail")&&(a="请求失败"),uni.$snowy.modal.alert(a),t(e)},complete:()=>{uni.$snowy.modal.closeLoading()}})}))},{TIMEOUT:ae,TOKEN_NAME:le,TOKEN_PREFIX:te}=o,ie={previewFile:e=>`${l.getters.allEnv[l.getters.envKey].baseUrl}${j("/dev/")}file/download?id=${e}`,fileUploadDynamicReturnId:e=>ee({url:"/dev/file/uploadDynamicReturnId",file:e.file,filePath:e.filePath}),fileUploadDynamicReturnUrl:e=>ee({url:"/dev/file/uploadDynamicReturnUrl",file:e.file,filePath:e.filePath}),fileUploadReturnId:e=>ee({url:"/dev/file/uploadLocalReturnId",file:e.file,filePath:e.filePath}),fileUploadAliyunReturnId:e=>ee({url:"/dev/file/uploadAliyunReturnId",file:e.file,filePath:e.filePath}),fileUploadTencentReturnId:e=>ee({url:"/dev/file/uploadTencentReturnId",file:e.file,filePath:e.filePath}),fileUploadMinioReturnId:e=>ee({url:"/dev/file/uploadMinioReturnId",file:e.file,filePath:e.filePath}),fileUploadLocalReturnUrl:e=>ee({url:"/dev/file/uploadLocalReturnUrl",file:e.file,filePath:e.filePath}),fileUploadAliyunReturnUrl:e=>ee({url:"/dev/file/uploadAliyunReturnUrl",file:e.file,filePath:e.filePath}),fileUploadTencentReturnUrl:e=>ee({url:"/dev/file/uploadTencentReturnUrl",file:e.file,filePath:e.filePath}),fileUploadMinioReturnUrl:e=>ee({url:"/dev/file/uploadMinioReturnUrl",file:e.file,filePath:e.filePath}),filePage:e=>L({url:"/dev/file/page",method:"GET",data:e}),fileList:e=>L({url:"/dev/file/list",method:"GET",data:e}),fileDownload:e=>(e=>{e.url=j(e.url);const i=!1===(e.extConf||{}).isToken;if(e.header=e.header||{},a()&&!i&&(e.header[le]=te+a()),e.header.Domain=l.getters.tenantDomain,e.params){let a=e.url+"?"+t(e.params);a=a.slice(0,-1),e.url=a}return new Promise(((a,t)=>{uni.$snowy.modal.loading("努力加载中"),F({url:(e.baseUrl||l.getters.allEnv[l.getters.envKey].baseUrl)+e.url,header:e.header,timeout:e.timeout||ae,success:e=>{a(e)},fail:e=>{t(e)},complete:()=>{uni.$snowy.modal.closeLoading()}})}))})({url:"/dev/file/download?id="+e}),fileDetail:e=>L({url:"/dev/file/detail",method:"GET",data:e}),fileDelete:e=>L({url:"/dev/file/delete",method:"POST",data:e})},re={idArrJsonStr:{code:"jsonStr"},idStr:{code:"idStr",separation:","},urlStr:{code:"urlStr",separation:","},idArr:{code:"idArr"},urlArr:{code:"urlArr"},objArr:{code:"objArr"}};Object.values(re);const de="success",ne=V({__name:"snowy-file-picker-api",props:{modelValue:{type:[String,Array]},map:{type:Object,default:()=>({id:"id",name:"name",url:"url",ext:"ext"}),required:!1},idDataType:{type:String,default:re.idStr.code,required:!1},disabled:{type:Boolean,default:!1,required:!1},mediaType:{type:String,default:"image",required:!1},sourceType:{type:Array,default:()=>["album","camera"]},uploadType:{type:String,default:"Dynamic"},limit:{type:Number,default:9}},emits:["update:modelValue"],setup(e,{emit:a}){const l=a,t=e,i=m(""),r=()=>{i.value=t.modelValue};console.log("hndis"),r(),c((()=>t.modelValue),((e,a)=>{e!==a&&r()}),{deep:!1,immediate:!1}),c((()=>i.value),((e,a)=>{e!==a&&l("update:modelValue",i.value)}),{deep:!0,immediate:!1});const d=(e,a)=>{ie.fileDetail({id:e[t.map.id]}).then((e=>{a({state:de,data:{[t.map.id]:e.id,[t.map.name]:e.name,[t.map.url]:ie.previewFile(e.id),[t.map.ext]:null==e?void 0:e.suffix}})}))},n=(e,a)=>{(e=>new Promise(((a,l)=>{"Local"==t.uploadType?ie.fileUploadReturnId(e).then((e=>{a(e)})).catch((e=>{l(e)})):"Aliyun"==t.uploadType?ie.fileUploadAliyunReturnId(e).then((e=>{a(e)})).catch((e=>{l(e)})):"Tencent"==t.uploadType?ie.fileUploadTencentReturnId(e).then((e=>{a(e)})).catch((e=>{l(e)})):ie.fileUploadDynamicReturnId(e).then((e=>{a(e)})).catch((e=>{l(e)}))})))({filePath:e.filePath}).then((e=>{ie.fileDetail({id:e}).then((e=>{a({state:de,data:{[t.map.id]:e.id,[t.map.name]:e.name,[t.map.url]:ie.previewFile(e.id),[t.map.ext]:e.suffix}})}))}))},u=(e,a)=>{console.log(e,"oarh"),a({state:de,data:null})};return(a,l)=>{const r=N(O("snowy-file-picker"),X),o=k;return h(),y(o,null,{default:g((()=>[v(r,{modelValue:i.value,"onUpdate:modelValue":l[0]||(l[0]=e=>i.value=e),map:e.map,idDataType:e.idDataType,onGetFileInfoById:d,onUploadFile:n,onDeleteFile:u,mediaType:t.mediaType,sourceType:t.sourceType,forbidAdd:t.disabled,forbidDel:t.disabled,limit:t.limit},null,8,["modelValue","map","idDataType","mediaType","sourceType","forbidAdd","forbidDel","limit"])])),_:1})}}},[["__scopeId","data-v-4374fe90"]]);export{ne as s};
