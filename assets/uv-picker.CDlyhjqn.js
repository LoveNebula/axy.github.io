var e,t;import{_ as n}from"./uv-toolbar.BkXgWcPp.js";import{ac as i,ad as l,d as o,e as s,j as a,f as r,w as u,k as c,m as d,x as m,F as h,H as p,G as f,l as C,t as v,q as g,aA as x,aB as y,i as I}from"./index-CPBjD6nT.js";import{_}from"./uv-loading-icon.Bz59kkyK.js";import{_ as k}from"./uv-popup.RS38a-ll.js";import{_ as $}from"./_plugin-vue_export-helper.BCo6x5W8.js";const b=$({name:"uv-picker",emits:["confirm","cancel","close","change"],mixins:[i,l,{props:{showToolbar:{type:Boolean,default:!0},title:{type:String,default:""},round:{type:[String,Number],default:0},columns:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},itemHeight:{type:[String,Number],default:44},cancelText:{type:String,default:"取消"},confirmText:{type:String,default:"确定"},cancelColor:{type:String,default:"#909193"},confirmColor:{type:String,default:"#3c9cff"},color:{type:String,default:""},activeColor:{type:String,default:""},visibleItemCount:{type:[String,Number],default:5},keyName:{type:String,default:"text"},closeOnClickOverlay:{type:Boolean,default:!0},closeOnClickConfirm:{type:Boolean,default:!0},defaultIndex:{type:Array,default:()=>[]},immediateChange:{type:Boolean,default:!1},...null==(t=null==(e=uni.$uv)?void 0:e.props)?void 0:t.picker}}],computed:{textStyle(){return(e,t)=>{const n={display:"block"};return this.color&&(n.color=this.color),this.activeColor&&t===this.innerIndex[e]&&(n.color=this.activeColor),n}}},data:()=>({lastIndex:[],innerIndex:[],innerColumns:[],columnIndex:0}),watch:{defaultIndex:{immediate:!0,handler(e){this.setIndexs(e,!0)}},columns:{immediate:!0,handler(e){this.setColumns(e)}}},methods:{open(){this.$refs.pickerPopup.open()},close(){this.$refs.pickerPopup.close()},popupChange(e){e.show||this.$emit("close")},getItemText(e){return this.$uv.test.object(e)?e[this.keyName]:e},cancel(){this.$emit("cancel"),this.close()},confirm(){this.$emit("confirm",this.$uv.deepClone({indexs:this.innerIndex,value:this.innerColumns.map(((e,t)=>e[this.innerIndex[t]])),values:this.innerColumns})),this.closeOnClickConfirm&&this.close()},changeHandler(e){const{value:t}=e.detail;let n=0,i=0;for(let o=0;o<t.length;o++){let e=t[o];if(e!==(this.lastIndex[o]||0)){i=o,n=e;break}}this.columnIndex=i;const l=this.innerColumns;this.setLastIndex(t),this.setIndexs(t),this.$emit("change",{value:this.innerColumns.map(((e,n)=>e[t[n]])),index:n,indexs:t,values:l,columnIndex:i})},setIndexs(e,t){this.innerIndex=this.$uv.deepClone(e),t&&this.setLastIndex(e)},setLastIndex(e){this.lastIndex=this.$uv.deepClone(e)},setColumnValues(e,t){this.innerColumns.splice(e,1,t);let n=this.$uv.deepClone(this.innerIndex);for(let i=0;i<this.innerColumns.length;i++)i>this.columnIndex&&(n[i]=0);this.setIndexs(n)},getColumnValues(e){return(async()=>{await this.$uv.sleep()})(),this.innerColumns[e]},setColumns(e){this.innerColumns=this.$uv.deepClone(e),0===this.innerIndex.length&&(this.innerIndex=new Array(e.length).fill(0))},getIndexs(){return this.innerIndex},getValues(){return(async()=>{await this.$uv.sleep()})(),this.innerColumns.map(((e,t)=>e[this.innerIndex[t]]))}}},[["render",function(e,t,i,l,$,b){const S=o(s("uv-toolbar"),n),T=g,w=x,H=y,j=o(s("uv-loading-icon"),_),B=I,O=o(s("uv-popup"),k);return a(),r(O,{ref:"pickerPopup",mode:"bottom",round:e.round,"close-on-click-overlay":e.closeOnClickOverlay,onChange:b.popupChange},{default:u((()=>[c(B,{class:"uv-picker"},{default:u((()=>[e.showToolbar?(a(),r(S,{key:0,cancelColor:e.cancelColor,confirmColor:e.confirmColor,cancelText:e.cancelText,confirmText:e.confirmText,title:e.title,onCancel:b.cancel,onConfirm:b.confirm},null,8,["cancelColor","confirmColor","cancelText","confirmText","title","onCancel","onConfirm"])):d("",!0),c(H,{class:"uv-picker__view",indicatorStyle:`height: ${e.$uv.addUnit(e.itemHeight)}`,value:$.innerIndex,immediateChange:e.immediateChange,style:m({height:`${e.$uv.addUnit(e.visibleItemCount*e.itemHeight)}`}),onChange:b.changeHandler},{default:u((()=>[(a(!0),h(p,null,f($.innerColumns,((t,n)=>(a(),r(w,{key:n,class:"uv-picker__view__column"},{default:u((()=>[e.$uv.test.array(t)?(a(!0),h(p,{key:0},f(t,((t,i)=>(a(),r(T,{class:"uv-picker__view__column__item uv-line-1",key:i,style:m([{height:e.$uv.addUnit(e.itemHeight),lineHeight:e.$uv.addUnit(e.itemHeight),fontWeight:i===$.innerIndex[n]?"bold":"normal"},b.textStyle(n,i)])},{default:u((()=>[C(v(b.getItemText(t)),1)])),_:2},1032,["style"])))),128)):d("",!0)])),_:2},1024)))),128))])),_:1},8,["indicatorStyle","value","immediateChange","style","onChange"]),e.loading?(a(),r(B,{key:1,class:"uv-picker--loading"},{default:u((()=>[c(j,{mode:"circle"})])),_:1})):d("",!0)])),_:1})])),_:1},8,["round","close-on-click-overlay","onChange"])}],["__scopeId","data-v-dd0d048b"]]);export{b as _};
