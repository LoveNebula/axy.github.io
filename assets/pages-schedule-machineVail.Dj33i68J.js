import{Y as e,r as l,b as t,D as a,d as n,e as s,f as u,w as o,i as d,j as i,k as r,l as c,t as p,F as f,G as _,H as m,K as v,x as y,m as g,q as x}from"./index-CPBjD6nT.js";import{_ as h}from"./uni-datetime-picker.Skz1SJ_2.js";import{_ as k}from"./uv-button.DCe9cTzF.js";import{_ as b}from"./uni-data-select.C8uCwS99.js";import{_ as w}from"./uni-popup.DLkoZhRS.js";import{l as j,m as L,n as V}from"./bizScheduApi.BbFgL-ID.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.BQCc16_L.js";/* empty css                                                                  */import"./uv-loading-icon.Bz59kkyK.js";import"./uv-icon.BeAryk0A.js";import"./uni-popup.vue_vue_type_style_index_0_scoped_f28c6336_lang.COK6mCff.js";const z=I({__name:"machineVail",setup(I){const z=l(uni.$nowDate),R=e=>{},C=t("storage_data");a((()=>{$()})),C.userInfo,l(null);const P=l(),D=l(),N=l(),S=l({}),U=l([]),A=l(""),M=l([]),O=l([]),$=()=>{j({departureDate:z.value,current:1,size:999}).then((e=>{console.log("res",e),N.value=e.data.records;const l=N.value.map((e=>e.checker));A.value=[...new Set(l)].filter((e=>""!==e&&null!==e)).join()}))};(function(l){return e({url:"/biz/org/selector",method:"get",data:l})})().then((e=>{O.value=e.data.map((e=>({value:e.name,text:e.name})))})),function(l){return e({url:"/biz/user/list",method:"get",data:l})}().then((e=>{U.value=e.data.map((e=>({value:e.name,text:e.name})))}));const F=l({}),Y=()=>{S.value.usePerson?L({...S.value}).then((e=>{v({title:"出库成功",duration:1500,icon:"none"}),P.value.close(),$()})):v({title:"请选择借用人",icon:"none"})},q=e=>{console.log(e)},G=()=>{S.value.returnPerson?(S.value.schedulingId=F.value.id,console.log("FormData.value",S.value),V({...S.value}).then((e=>{v({title:"入库成功",duration:1500,icon:"none"}),D.value.close(),$()}))):v({title:"请选择归还人",icon:"none"})},H=e=>{z.value=e,j({departureDate:e,current:1,size:999}).then((e=>{N.value=e.data.records}))};return(e,l)=>{const t=d,a=n(s("uni-datetime-picker"),h),v=x,j=n(s("uv-button"),k),L=n(s("uni-data-select"),b),V=n(s("uni-popup"),w);return i(),u(t,{class:"duleMain"},{default:o((()=>[r(t,{class:"dule_content"},{default:o((()=>[r(t,{class:"flexStart",style:{"margin-left":"5px","margin-top":"15px"}},{default:o((()=>[r(t,null,{default:o((()=>[c(" 选择出班日期：")])),_:1}),r(t,null,{default:o((()=>[r(a,{style:{width:"200px"},type:"date","clear-icon":!1,modelValue:z.value,"onUpdate:modelValue":l[0]||(l[0]=e=>z.value=e),onMaskClick:R,onChange:H},null,8,["modelValue"])])),_:1})])),_:1}),r(t,{class:"flexColumn",style:{"margin-left":"5px","margin-top":"15px"}},{default:o((()=>[r(t,{style:{"font-size":"18px","font-weight":"bold"}},{default:o((()=>[c(" 审核发布："+p(A.value),1)])),_:1}),r(t,{style:{"margin-top":"10px",width:"100%"}},{default:o((()=>[r(t,{class:"table_header"},{default:o((()=>[r(t,{style:{flex:"1"},class:"header_item"},{default:o((()=>[c("组长")])),_:1}),r(t,{style:{flex:"1"},class:"header_item"},{default:o((()=>[c("组员")])),_:1}),r(t,{style:{width:"33%"},class:"header_item"},{default:o((()=>[c("仪器")])),_:1}),r(t,{style:{flex:"1"},class:"header_item"},{default:o((()=>[c("车辆")])),_:1}),r(t,{style:{flex:"1"},class:"header_item"},{default:o((()=>[c("司机")])),_:1})])),_:1}),r(t,{class:"table_body"},{default:o((()=>[(i(!0),f(m,null,_(N.value,((l,a)=>(i(),u(t,{class:"body_item",key:a},{default:o((()=>[r(t,{class:"body_content"},{default:o((()=>[r(t,{class:"body_content_item"},{default:o((()=>[r(t,null,{default:o((()=>[c(p(l.projectId),1)])),_:2},1024),r(t,{style:{display:"flex","align-items":"center"}},{default:o((()=>[r(t,{class:"item_left"},{default:o((()=>[c(p(l.name),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),r(t,{class:"body_item_content"},{default:o((()=>[r(t,{style:{flex:"1"},class:"content_item"},{default:o((()=>[c(p(l.leader),1)])),_:2},1024),r(t,{style:{display:"flex",flex:"1","align-items":"center","justify-content":"center"},class:"content_item"},{default:o((()=>["[]"==l.members||null==l.members?(i(),u(t,{key:0})):(i(),u(t,{key:1,style:{display:"flex","flex-direction":"column",padding:"5px 0"}},{default:o((()=>[(i(!0),f(m,null,_(l.members.split(","),((e,l)=>(i(),u(t,{key:l},{default:o((()=>[c(p(e),1)])),_:2},1024)))),128))])),_:2},1024))])),_:2},1024),r(t,{style:{width:"33%","border-right":"1px solid","font-size":"14px"}},{default:o((()=>["[]"==l.device||null==l.device?(i(),f("p",{key:0})):(i(),u(t,{key:1},{default:o((()=>[(i(!0),f(m,null,_(l.device.split(","),((t,a)=>(i(),f("p",{key:e.sindex,style:{"word-wrap":"break-word"}},p(t)+" "+p(l.device.length>0?",":""),1)))),128))])),_:2},1024))])),_:2},1024),r(t,{style:{flex:"1"},class:"content_item"},{default:o((()=>[c(p(l.vehicle),1)])),_:2},1024),r(t,{style:{flex:"1"},class:"content_item"},{default:o((()=>[c(p(l.driver),1)])),_:2},1024)])),_:2},1024),r(t,{class:"body_header"},{default:o((()=>[r(t,null,{default:o((()=>[c(p(l.name),1)])),_:2},1024)])),_:2},1024),r(t,{class:"machine_status"},{default:o((()=>{var a,n,s,d,x;return[(null==(a=l.noReturnedList)?void 0:a.length)>0&&(null==(n=l.returnedList)?void 0:n.length)>0?(i(),u(t,{key:0,style:{"text-align":"center","font-size":"17px","font-weight":"bold",color:"green",padding:"15px"}},{default:o((()=>[r(t,null,{default:o((()=>[c("有单独入库的仪器，剩余请在web端操作")])),_:1}),r(t,null,{default:o((()=>[c("未入库仪器编号")])),_:1}),(i(!0),f(m,null,_(l.noReturnedList,(e=>(i(),u(t,{key:e.instrument_id,style:{color:"#ff000f"}},{default:o((()=>[c(p(e.instrument_id),1)])),_:2},1024)))),128))])),_:2},1024)):(null==(s=l.noReturnedList)?void 0:s.length)>0&&null==l.returnedList?(i(),u(t,{key:1,style:{"text-align":"center","font-size":"17px","font-weight":"bold",color:"green",padding:"15px"}},{default:o((()=>[c("已出库")])),_:1})):null==l.noReturnedList&&(null==(d=l.returnedList)?void 0:d.length)>0?(i(),u(t,{key:2,style:{"text-align":"center","font-size":"17px","font-weight":"bold",color:"green",padding:"15px"}},{default:o((()=>[c("已入库")])),_:1})):(i(),u(t,{key:3,style:y([{color:l.mstatus?"#000":"red"},{"text-align":"center"}])},{default:o((()=>{var e;return["解决问题"==l.notes?(i(),u(t,{key:0,style:{color:"green"}},{default:o((()=>[c("该项目为解决问题")])),_:1})):g("",!0),(null==(e=l.noDisclosure)?void 0:e.length)>0?(i(),u(t,{key:1,style:{color:"red"}},{default:o((()=>{var e;return[c(" 未交底人： "+p(null==(e=l.noDisclosure)?void 0:e.join(",")),1)]})),_:2},1024)):(i(),u(t,{key:2,style:{color:"green","text-align":"center"}},{default:o((()=>[c("人员已交底")])),_:1})),null==l.deviceList&&null==l.noDisclosure||null==l.deviceList&&"解决问题"==l.notes?(i(),u(v,{key:3,style:{color:"green"}},{default:o((()=>[c("仪器可正常出库")])),_:1})):(i(),u(t,{key:4,style:{color:"red","text-align":"center"}},{default:o((()=>[r(v,{style:{"text-align":"center"}},{default:o((()=>[c("仪器不可正常出库")])),_:1}),(i(!0),f(m,null,_(l.deviceList,((e,l)=>(i(),u(t,{key:l},{default:o((()=>[c(p(Object.keys(e)[0])+": "+p(Object.values(e)[0]),1)])),_:2},1024)))),128))])),_:2},1024))]})),_:2},1032,["style"])),null==l.returnedList&&null==l.noReturnedList&&e.$snowy.hasPerm(["gz_worker"])?(i(),u(t,{key:4,class:"lbtn"},{default:o((()=>[r(j,{type:"primary",onClick:e=>(e=>{var l,t;S.value.usePerson="",F.value=e,S.value.outRegistrant="王庆年",S.value.projectId=F.value.projectId,S.value.projectName=F.value.name,S.value.instrumentIdList=null!=e.device?e.device.match(/\(([^)]+)\)/g).map((e=>e.replace(/\(|\)/g,""))):null,S.value.type="运行",S.value.schedulingId=e.id;let a=null==(l=e.leader)?void 0:l.split(",");a.push(e.driver),a.push(...null==e.members?[]:null==(t=e.members)?void 0:t.split(","));let n=new Set(a),s=Array.from(n.values());console.log(s),M.value=s.map((e=>({value:e,text:e}))),P.value.open(),console.log("selectList.value",M.value)})(l)},{default:o((()=>[c("出库")])),_:2},1032,["onClick"])])),_:2},1024)):g("",!0),(null==(x=l.noReturnedList)?void 0:x.length)>0&&null==l.returnedList&&e.$snowy.hasPerm(["gz_worker"])?(i(),u(t,{key:5,class:"rbtn"},{default:o((()=>[r(j,{type:"primary",onClick:e=>(e=>{S.value.returnPerson="",F.value=e,S.value.inRegistrant="王庆年",S.value.projectId=F.value.projectId,S.value.projectName=F.value.name,S.value.instrumentIdList=null!=e.device?e.device.match(/\(([^)]+)\)/g).map((e=>e.replace(/\(|\)/g,""))):null,S.value.schedulingId=e.id;let l=e.members.split(",");l.push(e.driver),l.push(e.leader);let t=new Set(l),a=Array.from(t.values());console.log(a),M.value=a.map((e=>({value:e,text:e}))),D.value.open()})(l)},{default:o((()=>[c("入库")])),_:2},1032,["onClick"])])),_:2},1024)):g("",!0)]})),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})])),_:1}),r(V,{ref_key:"Lpopup",ref:P,type:"center"},{default:o((()=>[r(t,{class:"popup-content"},{default:o((()=>[r(t,{style:{"font-size":"18px","font-weight":"bold"}},{default:o((()=>[c("出库登记")])),_:1}),r(t,{class:"content-item"},{default:o((()=>[r(t,{class:"",style:{width:"120px"}},{default:o((()=>[c(" 出库登记人: ")])),_:1}),r(L,{localdata:U.value,modelValue:S.value.outRegistrant,"onUpdate:modelValue":l[1]||(l[1]=e=>S.value.outRegistrant=e),style:{width:"170px"},onChange:q},null,8,["localdata","modelValue"])])),_:1}),r(t,{class:"content-item"},{default:o((()=>[r(t,{class:"",style:{width:"120px"}},{default:o((()=>[c(" 工程编号: ")])),_:1}),r(t,{style:{flex:"1"}},{default:o((()=>[c(p(S.value.projectId),1)])),_:1})])),_:1}),r(t,{class:"content-item"},{default:o((()=>[r(t,{class:"",style:{width:"120px"}},{default:o((()=>[c(" 工程名称: ")])),_:1}),r(t,{style:{flex:"1"}},{default:o((()=>[c(p(S.value.projectName),1)])),_:1})])),_:1}),r(t,{class:"content-item"},{default:o((()=>[r(t,{class:"",style:{width:"120px"}},{default:o((()=>[c(" 借用人: ")])),_:1}),r(L,{localdata:M.value,modelValue:S.value.usePerson,"onUpdate:modelValue":l[2]||(l[2]=e=>S.value.usePerson=e),style:{width:"170px"},onChange:q},null,8,["localdata","modelValue"])])),_:1}),r(j,{type:"primary",onClick:Y},{default:o((()=>[c("确认")])),_:1})])),_:1})])),_:1},512),r(V,{ref_key:"Rpopup",ref:D,type:"center"},{default:o((()=>[r(t,{class:"popup-content"},{default:o((()=>[r(t,{style:{"font-size":"18px","font-weight":"bold"}},{default:o((()=>[c("入库登记")])),_:1}),r(t,{class:"content-item"},{default:o((()=>[r(t,{class:"",style:{width:"120px"}},{default:o((()=>[c(" 入库登记人: ")])),_:1}),r(L,{localdata:U.value,modelValue:S.value.inRegistrant,"onUpdate:modelValue":l[3]||(l[3]=e=>S.value.inRegistrant=e),style:{width:"170px"}},null,8,["localdata","modelValue"])])),_:1}),r(t,{class:"content-item"},{default:o((()=>[r(t,{class:"",style:{width:"120px"}},{default:o((()=>[c(" 工程编号: ")])),_:1}),r(t,{style:{flex:"1"}},{default:o((()=>[c(p(S.value.projectId),1)])),_:1})])),_:1}),r(t,{class:"content-item"},{default:o((()=>[r(t,{class:"",style:{width:"120px"}},{default:o((()=>[c(" 工程名称: ")])),_:1}),r(t,{style:{flex:"1"}},{default:o((()=>[c(p(S.value.projectName),1)])),_:1})])),_:1}),r(t,{class:"content-item"},{default:o((()=>[r(t,{class:"",style:{width:"120px"}},{default:o((()=>[c(" 归还人: ")])),_:1}),r(L,{localdata:M.value,modelValue:S.value.returnPerson,"onUpdate:modelValue":l[4]||(l[4]=e=>S.value.returnPerson=e),style:{width:"170px"}},null,8,["localdata","modelValue"])])),_:1}),r(j,{type:"primary",onClick:G},{default:o((()=>[c("确认")])),_:1})])),_:1})])),_:1},512)])),_:1})}}},[["__scopeId","data-v-08cb3a71"]]);export{z as default};
